import { useMemo } from "react";
import SiswaLayout from "../../component/Siswa/SiswaLayout";

type SiswaPage = "dashboard" | "jadwal-anda" | "notifikasi";

interface JadwalSiswaProps {
  user: { name: string; phone: string };
  currentPage: SiswaPage;
  onMenuClick: (page: string) => void;
  onLogout: () => void;
}

type Cell = { label: string; sub?: string };
type ScheduleGrid = Cell[][];

export default function JadwalSiswa({
  user,
  currentPage,
  onMenuClick,
  onLogout,
}: JadwalSiswaProps) {
  // Dummy data - nanti dari API
  const kelasInfo = {
    namaKelas: "X Mekatronika 1",
    waliKelas: "Ewit Erniyah S.pd",
  };

  // Waktu untuk setiap jam pelajaran (07.00-08.00, 08.00-09.00, dst)
  const waktuJadwal = useMemo(() => {
    const times = [];
    for (let i = 0; i < 10; i++) {
      const start = 7 + i;
      const end = 8 + i;
      times.push(`${start.toString().padStart(2, "0")}.00-${end.toString().padStart(2, "0")}.00`);
    }
    return times;
  }, []);

  // Headers untuk tabel - 10 jam pelajaran
  const headers = useMemo(() => {
    return Array.from({ length: 10 }, (_, i) => (i + 1).toString());
  }, []);

  const rows = ["Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];

  // Grid jadwal - [hari][jam] - sesuai dengan gambar
  const grid: ScheduleGrid = useMemo(() => {
    const schedule: ScheduleGrid = [];
    
    // Inisialisasi semua sel kosong
    for (let i = 0; i < rows.length; i++) {
      schedule[i] = [];
      for (let j = 0; j < headers.length; j++) {
        schedule[i][j] = { label: "", sub: "" };
      }
    }

    // Data sesuai gambar:
    // Row 1 (Senin): MTK di kolom 1, 3, 7
    schedule[0][0] = { label: "MTK", sub: "RR.Henning Gratyanis S.pd" };
    schedule[0][2] = { label: "MTK", sub: "RR.Henning Gratyanis S.pd" };
    schedule[0][6] = { label: "MTK", sub: "RR.Henning Gratyanis S.pd" };

    // Row 2 (Selasa): MTK di kolom 1, 3, 5, 9
    schedule[1][0] = { label: "MTK", sub: "RR.Henning Gratyanis S.pd" };
    schedule[1][2] = { label: "MTK", sub: "RR.Henning Gratyanis S.pd" };
    schedule[1][4] = { label: "MTK", sub: "RR.Henning Gratyanis S.pd" };
    schedule[1][8] = { label: "MTK", sub: "RR.Henning Gratyanis S.pd" };

    // Row 3 (Rabu): MTK di kolom 1, 5, 9
    schedule[2][0] = { label: "MTK", sub: "RR.Henning Gratyanis S.pd" };
    schedule[2][4] = { label: "MTK", sub: "RR.Henning Gratyanis S.pd" };
    schedule[2][8] = { label: "MTK", sub: "RR.Henning Gratyanis S.pd" };

    // Row 4, 5, 6 (Kamis, Jumat, Sabtu): kosong

    return schedule;
  }, []);

  return (
    <SiswaLayout
      pageTitle="Jadwal Kelas"
      currentPage={currentPage}
      onMenuClick={onMenuClick}
      user={user}
      onLogout={onLogout}
    >
      <div style={{ display: "flex", flexDirection: "column", gap: 24 }}>
        {/* Box Informasi Kelas */}
        <div
          style={{
            background: "#0B2948",
            borderRadius: 12,
            padding: "20px 24px",
            display: "flex",
            alignItems: "center",
            gap: 16,
            boxShadow: "0 4px 12px rgba(0, 0, 0, 0.1)",
          }}
        >
          {/* Icon Building */}
          <div
            style={{
              width: 40,
              height: 40,
              borderRadius: 8,
              background: "rgba(255, 255, 255, 0.1)",
              display: "flex",
              alignItems: "center",
              justifyContent: "center",
              flexShrink: 0,
            }}
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M3 21H21M5 21V7L13 2L21 7V21M5 21H9M21 21H17M9 21V13H15V21M9 21H15"
                stroke="white"
                strokeWidth="2"
                strokeLinecap="round"
                strokeLinejoin="round"
              />
            </svg>
          </div>

          {/* Info Kelas */}
          <div style={{ flex: 1 }}>
            <div
              style={{
                color: "#FFFFFF",
                fontSize: "18px",
                fontWeight: 700,
                marginBottom: 4,
              }}
            >
              {kelasInfo.namaKelas}
            </div>
            <div
              style={{
                color: "rgba(255, 255, 255, 0.8)",
                fontSize: "14px",
                fontWeight: 500,
              }}
            >
              {kelasInfo.waliKelas}
            </div>
          </div>
        </div>

        {/* Tabel Jadwal */}
        <div
          style={{
            background: "#FFFFFF",
            borderRadius: 12,
            boxShadow: "0 4px 12px rgba(0, 0, 0, 0.08)",
            overflow: "hidden",
          }}
        >
          <div style={{ overflowX: "auto" }}>
            <table
              style={{
                borderCollapse: "collapse",
                width: "100%",
                minWidth: 800,
              }}
            >
              <thead>
                <tr>
                  <th
                    style={{
                      border: "1px solid #E2E8F0",
                      padding: "12px 16px",
                      background: "#F8FAFC",
                      fontWeight: 700,
                      fontSize: "14px",
                      color: "#0F172A",
                      textAlign: "left",
                    }}
                  >
                    Hari
                  </th>
                  {headers.map((h, i) => (
                    <th
                      key={i}
                      style={{
                        border: "1px solid #E2E8F0",
                        padding: "12px 8px",
                        background: "#F8FAFC",
                        fontWeight: 700,
                        fontSize: "14px",
                        color: "#0F172A",
                        textAlign: "center",
                        minWidth: 100,
                      }}
                    >
                      <div>{h}</div>
                      <div
                        style={{
                          fontSize: "11px",
                          fontWeight: 500,
                          color: "#64748B",
                          marginTop: 4,
                        }}
                      >
                        ({waktuJadwal[i]})
                      </div>
                    </th>
                  ))}
                </tr>
              </thead>
              <tbody>
                {rows.map((row, ri) => (
                  <tr key={ri}>
                    <td
                      style={{
                        border: "1px solid #E2E8F0",
                        padding: "12px 16px",
                        fontWeight: 600,
                        fontSize: "14px",
                        color: "#0F172A",
                        background: "#FFFFFF",
                      }}
                    >
                      {row}
                    </td>
                    {grid[ri].map((cell, ci) => (
                      <td
                        key={ci}
                        style={{
                          border: "1px solid #E2E8F0",
                          padding: "12px 8px",
                          background: cell.label ? "#E5E7EB" : "#FFFFFF",
                          textAlign: "center",
                          verticalAlign: "top",
                        }}
                      >
                        {cell.label && (
                          <>
                            <div
                              style={{
                                fontWeight: 700,
                                fontSize: "14px",
                                color: "#0F172A",
                                marginBottom: 4,
                              }}
                            >
                              {cell.label}
                            </div>
                            {cell.sub && (
                              <div
                                style={{
                                  fontSize: "12px",
                                  color: "#475569",
                                  fontWeight: 500,
                                }}
                              >
                                {cell.sub}
                              </div>
                            )}
                          </>
                        )}
                      </td>
                    ))}
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </SiswaLayout>
  );
}